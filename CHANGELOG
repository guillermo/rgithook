v3.0.0 Second big refactoring